{% extends 'base_without_search.html' %}

{% block title %}Home{% endblock %}

{% block content %}
<style>
    .slide {
        width: 300px;
        margin-right: 20px;
        /* Margin between slides */
        display: inline-flex;
        /* Use inline-flex for better control */
        flex-direction: column;
        justify-content: space-between;
        height: 400px;
    }

    /* Style adjustments for the container to ensure consistent margins */
    #slides-container {
        margin-right: -20px;
        /* Negative margin to counteract last slide margin */
    }

    .slide:last-child {
        margin-right: 0;
        /* Ensures the last slide doesn't have extra space on the right */
    }

    .slide h2 {
        margin-bottom: 0.5rem;
    }

    .slide img {
        max-height: 280px;
        object-fit: cover;
        object-position: bottom;
    }

    .hide-scroll-bar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .hide-scroll-bar::-webkit-scrollbar {
        display: none;
    }
</style>

<div class="container mx-auto mt-8 overflow-hidden">
    <h1 class="text-4xl font-bold mb-6 text-center">Welcome to Our Shoe Store</h1>
    <div class="flex overflow-x-scroll hide-scroll-bar pb-10">
        <div id="slides-container" class="flex flex-nowrap">
            {% for shoe in shoes %}
            <div class="inline-block px-3">
                <div class="slide rounded-lg shadow-lg bg-white p-6">
                    <h2 class="text-2xl font-semibold">{{ shoe.name }}</h2>
                    <img src="{{ url_for('static', filename='images/' + shoe.image_url) }}" alt="{{ shoe.name }}"
                        class="rounded-lg">
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        const slidesContainer = document.getElementById('slides-container');
        let currentIndex = 0;
        let interval = null;

        // Clona le slide originali e aggiungile alla fine del carosello
        document.querySelectorAll('.slide').forEach((slide, index) => {
            const cloneSlide = slide.cloneNode(true);
            // Ensure the last clone does not have the extra margin
            if (index === document.querySelectorAll('.slide').length - 1) {
                cloneSlide.classList.add('last-clone'); // Use a class to identify the last clone
                cloneSlide.style.marginRight = '0px';
            }
            slidesContainer.appendChild(cloneSlide);
        });

        // Adjust the slide width and margin in the translation calculation
        const slideWidth = 300; // Slide width
        const slideMargin = 20; // Slide margin

        function cycleSlides() {
            currentIndex++;
            // Reset the current index if it's greater than the number of original slides
            if (currentIndex > document.querySelectorAll('.slide').length / 2 - 1) {
                currentIndex = 0;
                // Immediately reset the position without transition
                slidesContainer.style.transition = 'none';
                slidesContainer.style.transform = `translateX(${currentIndex * (slideWidth + slideMargin)}px)`;
                // Force a reflow
                slidesContainer.offsetWidth;
                // Then, add transitions back after a moment
                setTimeout(() => {
                    slidesContainer.style.transition = 'transform 0.3s ease-out';
                    currentIndex++; // Move to the next slide
                    slidesContainer.style.transform = `translateX(-${currentIndex * (slideWidth + slideMargin)}px)`;
                }, 10);
            } else {
                slidesContainer.style.transition = 'transform 0.3s ease-out';
                slidesContainer.style.transform = `translateX(-${currentIndex * (slideWidth + slideMargin)}px)`;
            }
        }

        interval = setInterval(cycleSlides, 2000); // Adjust time as needed

        window.addEventListener('beforeunload', () => {
            if (interval) {
                clearInterval(interval);
            }
        });
    });
</script>
{% endblock %}